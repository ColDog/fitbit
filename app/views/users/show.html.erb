<div class="container-fluid">
<h1><%= @user.name %></h1>
<%= link_to 'Log Out', "/logout/#{@user.id}", method: :post %> | <%= link_to 'Delete My Account', user_path(@user), method: :delete, confirm: 'This will delete all of your account information from our database.' %>


<div class="date-picker row" style="max-width: 800px; margin: auto">
	<div class="col-md-4 col-sm-4">
		<%= params[:date] ? link_to('Yesterday', user_path(@user, date: params[:date].to_date - 1), class: 'btn btn-default center-block') : link_to('Yesterday', user_path(@user, date: Date.today - 1), class: 'btn btn-default center-block') %>
	</div>
	<div class="col-md-4 col-sm-4">
		<%= form_tag(user_path(@user), method: 'get', enforce_utf8: false) do %>
			<div class="input-group">
				<%= date_field_tag :date, params[:date], class: 'form-control' %>
				<span class="input-group-btn">
					<%= submit_tag "Go", name: nil, class: 'btn btn-default' %>
				</span>
			</div>
		<% end %>
		<h3 class="center-block" style="text-align: center;"><%= params[:date] ? params[:date].to_date.strftime('%A %B %-d') : 'Select a date' %></h3>
		<h5 style="text-align: center;"><%= link_to 'Today', user_path(@user, date: Date.today) %></h5>
	</div>
	<div class="col-md-4 col-sm-4"><%= params[:date] ? link_to('Tomorrow', user_path(@user, date: params[:date].to_date + 1), class: 'btn btn-default center-block') : link_to('Tomorrow', user_path(@user, date: Date.today + 1), class: 'btn btn-default center-block')  %></div>
</div>

	<br />
	<br />

<% if @data && @data.sleep && @data.start_time && @data.time_in_bed %>
	<div class="row">
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= @user.average_nightly_sleep %>h</h2>
				<h5>Average Sleep</h5>
			</div>
		</div>
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= @data.start_time.to_time.strftime('%I:%M') %></h2>
				<h5>Start Time</h5>
			</div>
		</div>
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= (@data.time_in_bed.to_f / 60).round(2) %>h</h2>
				<h5>Time in Bed</h5>
			</div>
		</div>
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= (@data.minutes_asleep.to_f / 60).round(2) %>h</h2>
				<h5>Time Asleep</h5>
			</div>
		</div>
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= @data.efficiency %></h2>
				<h5>Sleep Efficiency</h5>
			</div>
		</div>
		<div class="col-md-2 col-xs-4">
			<div class="thumbnail" style="background-color: #a8dcff">
				<h2 style="text-align: center;"><%= @data.minutes_awake %>min</h2>
				<h5>Time Awake</h5>
			</div>
		</div>
	</div>
<hr>
<div style="width: 100%; max-width: 1000px; overflow: scroll; margin: auto">
	<canvas id="timeSeries" height="600" width="1000"></canvas>
</div>

<script>
	$( document ).ready(function() {
		var ctx = $("#timeSeries").get(0).getContext("2d");
		var options = {
			scaleShowGridLines : false,
			scaleGridLineColor : "rgba(0,0,0,.05)",
			scaleGridLineWidth : 1,
			scaleShowHorizontalLines: true,
			scaleShowVerticalLines: true,
			bezierCurve : true,
			bezierCurveTension : 0.5,
			pointDot : false,
			pointDotRadius : 4,
			pointDotStrokeWidth : 1,
			pointHitDetectionRadius : 1,
			datasetStroke : true,
			datasetStrokeWidth : 5,
			datasetFill : true,
			responsive: true
		};
		var bar_options = {
			scaleBeginAtZero : true,
			scaleShowGridLines : false,
			scaleGridLineColor : "rgba(0,0,0,.05)",
			scaleGridLineWidth : 1,
			scaleShowHorizontalLines: true,
			scaleShowVerticalLines: true,
			barShowStroke : true,
			barStrokeWidth : 2,
			barValueSpacing : 5,
			barDatasetSpacing : 1,
		};
		var data = {
			labels: <%=raw @data.minute_data_times %>,
			datasets: [
				{ label: 'Movement',
					data: <%= @data.minute_data_values %>,
					fillColor: "rgba(0,100,192,0.3)",
					strokeColor: "rgba(0,100,192,0.1)",
					pointColor: "rgba(0,100,192,0.3)"
				}
			]
		};
		var lineChart = new Chart(ctx).Line(data, options);
		console.log( "ready!" );
	});
</script>
<% else %>
	<h1>Don't have sleep data for today</h1>
<% end %>

</div>